SELECT distinct fo.date_key,
tp.timecategory,
tp.subperiod,
tp.period,
date_format (fo.date_key, '%W') AS weekday,
tp.subperiod2 AS time_period,
l.city_name,
    (CASE when hex_code(origin_latitude, origin_longitude) IN (54082050, 54082056, 54082058, 54082080, 54082082, 54081707, 54082049, 54082051, 54082057, 54082059, 54082081, 54082083, 54082089, 54082091, 54081702, 54081708, 54081710, 54082052, 54082054, 54082060, 54082062, 54082084, 54082086, 54082092, 54082094, 54081679, 54081701, 54081703, 54081709, 54081711, 54082053, 54082055, 54082061, 54082063, 54082085, 54082087, 54082093, 54082095, 54082181, 54081688, 54081690, 54081712, 54081714, 54081720, 54081722, 54082064, 54082066, 54082072, 54082074, 54082096, 54082098, 54082104, 54082106, 54082192, 54081683, 54081689, 54081691, 54081713, 54081715, 54081721, 54081723, 54082065, 54082067, 54082073, 54082075, 54082097, 54082099, 54082105, 54082107, 54082193, 54082195, 54081684, 54081686, 54081692, 54081694, 54081716, 54081718, 54081724, 54081726, 54082068, 54082070, 54082076, 54082078, 54082100, 54082102, 54082108, 54082110, 54082196, 54082198, 54081599, 54081685, 54081687, 54081693, 54081695, 54081717, 54081719, 54081725, 54081727, 54082069, 54082071, 54082077, 54082079, 54082101, 54082103, 54082109, 54082111, 54082197, 54082199, 54081640, 54081642, 54081728, 54081730, 54081736, 54081738, 54081760, 54081762, 54081768, 54082114, 54082120, 54082122, 54082144, 54082146, 54082152, 54082154, 54082240, 54082242, 54081635, 54081641, 54081643, 54081729, 54081731, 54081737, 54081739, 54081761, 54082123, 54082145, 54082147, 54082153, 54082155, 54082241, 54081636, 54081638, 54081644, 54081646, 54081732, 54081734, 54081740, 54081742, 54082126, 54082148, 54082150, 54082156, 54082158, 54082244, 54081615, 54081637, 54081639, 54081645, 54081647, 54081733, 54081735, 54082127, 54082149, 54082151, 54082157, 54082159, 54081624, 54081626, 54081648, 54081650, 54081656, 54081658, 54081744, 54081746, 54082138, 54082160, 54082162, 54082168, 54082170, 54081625, 54081627, 54081649, 54081651, 54081657, 54081659, 54081745, 54082137, 54082139, 54082161, 54082163, 54082169, 54081628, 54081630, 54081652, 54081654, 54081660, 54081662, 54081748, 54082140, 54082142, 54082164, 54082166, 54082172, 54081629, 54081631, 54081653, 54081655, 54081661, 54081663, 54082135, 54082141, 54082143, 54082165, 54082167, 54081794, 54081800, 54081802, 54081824, 54081826, 54081832, 54081834, 54081920, 54082304, 54082306, 54082312, 54082314, 54082336, 54082338, 54081793, 54081795, 54081801, 54081803, 54081825, 54081827, 54081833, 54081835, 54081921, 54081963, 54082305, 54082307, 54082313, 54082315, 54082337, 54081796, 54081798, 54081804, 54081806, 54081828, 54081830, 54081836, 54081838, 54081924, 54081926, 54081932, 54081934, 54081958, 54081964, 54081966, 54082308, 54082310, 54082316, 54082318, 54082340, 54081797, 54081799, 54081805, 54081807, 54081829, 54081831, 54081837, 54081839, 54081925, 54081927, 54081933, 54081935, 54081957, 54081959, 54081965, 54081967, 54082309, 54082311, 54082317, 54081808, 54081810, 54081816, 54081818, 54081840, 54081842, 54081848, 54081850, 54081936, 54081938, 54081944, 54081946, 54081968, 54081970, 54081976, 54081978, 54082320, 54082322, 54081809, 54081811, 54081817, 54081819, 54081841, 54081843, 54081849, 54081851, 54081937, 54081939, 54081945, 54081947, 54081969, 54081971, 54081977, 54081979, 54081812, 54081814, 54081820, 54081822, 54081844, 54081846, 54081852, 54081854, 54081940, 54081942, 54081948, 54081950, 54081972, 54081974, 54081980, 54081813, 54081815, 54081821, 54081823, 54081845, 54081847, 54081853, 54081855, 54081941, 54081943, 54081949, 54081951, 54081973, 54081975, 54081856, 54081858, 54081864, 54081866, 54081888, 54081890, 54081896, 54081898, 54081984, 54081986, 54081992, 54081857, 54081859, 54081865, 54081867, 54081889, 54081891, 54081897, 54081899, 54081860, 54081862, 54081868, 54081861)
THEN 'TTK w/o Sadovoye'
when hex_code(origin_latitude, origin_longitude) IN (54081725, 54081727, 54082069, 54082071, 54082077, 54081760, 54081762, 54081768, 54081770, 54082112, 54082114, 54082120, 54082122, 54081739, 54081761, 54081763, 54081769, 54081771, 54082113, 54082115, 54082121, 54082123, 54081740, 54081742, 54081764, 54081766, 54081772, 54081774, 54082116, 54082118, 54082124, 54082126, 54081735, 54081741, 54081743, 54081765, 54081767, 54081773, 54081775, 54082117, 54082119, 54082125, 54082127, 54081744, 54081746, 54081752, 54081754, 54081776, 54081778, 54081784, 54081786, 54082128, 54082130, 54082136, 54082138, 54081745, 54081747, 54081753, 54081755, 54081777, 54081779, 54081785, 54081787, 54082129, 54082131, 54082137, 54081662, 54081748, 54081750, 54081756, 54081758, 54081780, 54081782, 54081788, 54081790, 54082132, 54082134, 54082140, 54081663, 54081749, 54081751, 54081757, 54081759, 54081781, 54081783, 54081789, 54081791, 54082133, 54082135, 54081834, 54081920, 54081922, 54081928, 54081930, 54081952, 54081954, 54081960, 54081962, 54082304, 54081835, 54081921, 54081923, 54081929, 54081931, 54081953, 54081955, 54081961, 54081963, 54081924, 54081926, 54081932, 54081934, 54081956, 54081958, 54081964, 54081927, 54081933, 54081935, 54081957, 54081959)
THEN 'Sadovoye ring'
 ELSE 'other' end) AS area,
 fo.ordering_corporate_account_gk,
(CASE when v.vendor_name like '%courier car%' THEN 'PHV'
                              when v.vendor_name like '%courier pedestrian%' THEN 'pedestrian'
                              when v.vendor_name like '%courier scooter%' THEN 'scooter'
                              when  v.vendor_name like '%courier trike%' THEN 'e-bike'
                              ELSE 'taxi' end) AS supply_type,
 v."vendor_name",
 CASE when day(fo.date_key - "registration_date_key") >= 30 THEN '30days+' ELSE '<30days' end AS registration_group,
 fo.driver_gk
 FROM "emilia_gettdwh"."dwh_fact_orders_v" fo
LEFT JOIN emilia_gettdwh.dwh_dim_drivers_v d ON d.driver_gk = fo.driver_gk
LEFT JOIN emilia_gettdwh.dwh_dim_vendors_v v ON d.fleet_gk = v.vendor_gk
 LEFT JOIN "emilia_gettdwh"."dwh_dim_locations" l ON l.location_key = fo."origin_location_key"
 LEFT JOIN  emilia_gettdwh.periods_v AS tp ON tp.hour_key = fo.hour_key and tp.date_key = fo.date_key
       and tp.timecategory IN ('2.Dates', '3.Weeks', '4.Months', '5.Quarters', '7.Std Hours')
WHERE fo.country_key = 2
and lob_key IN (5,6)
and order_status_key = 7
and fo.date_key >= date'2020-07-01'
and tp.timecategory is not null





select
distinct driver_gk,
count(case when fo.order_status_key = 7 then fo.order_gk end ) compl_orders

FROM "emilia_gettdwh"."dwh_fact_orders_v" fo
LEFT JOIN emilia_gettdwh.dwh_dim_drivers_v d ON d.driver_gk = fo.driver_gk
LEFT JOIN emilia_gettdwh.dwh_dim_vendors_v v ON d.fleet_gk = v.vendor_gk
left join emilia_gettdwh.dwh_fact_offers_v fof on fo.order_gk = fof.order_gk

where d.country_key = 2
and lob_key in (5,6)
and date_key >= date'2020-10-01'
and v.vendor_name like '%courier car%' THEN 'PHV'

select * from emilia_gettdwh.dwh_fact_driver_activity_score_v limit 2;